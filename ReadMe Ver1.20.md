#  GPSルート表示・誘導 Ver1.20

## 概要

このプロジェクトは、WebブラウザのGeolocation APIとLeaflet.jsライブラリを組み合わせて、ユーザーの現在の位置を地図上に表示し、さらにGPX形式のルートファイルを読み込んだり、地図をクリックして目的地を設定したりしてルート案内を行うWebアプリケーションです。

ユーザーは、**GPXルート**または**目的地ルート**のいずれかを選択して誘導を開始できます。誘導中は、現在地がリアルタイムで更新され、終点までの距離やルートからのずれを確認できます。

## 特徴

*   **2種類のルート設定方法**:
    *   **GPXルート**: GPX形式のルートファイルをアップロードし、地図上に表示します。
    *   **目的地ルート**: 地図上の任意の場所をクリックして目的地を設定し、現在地からのルートを自動で計算・表示します。（経路計算には[OSRM](http://project-osrm.org/)を使用）
*   **現在地表示と追跡**: ボタン一つでGPS現在地を取得し、地図上にマーカーとして表示します。誘導中は現在地を自動で追跡し、地図の中心に表示します。
*   **精度情報**: 取得した位置情報の精度（メートル単位）をポップアップとステータスメッセージで表示します。
*   **リアルタイムルート誘導**:
    *   現在地からルートの終点までの残りの距離を表示します。
    *   現在地からルート上の最も近い地点までの距離を表示し、ルートからのずれを把握できます。
    *   **目的地ルート**の場合、ユーザーの移動に合わせて現在地がルートの始点となり、**ルートが動的に再計算**されます。
*   **ルートのクリア機能**: 「ルートクリア」ボタンで設定したルート（GPXまたは目的地）を簡単に削除できます。
*   **地図の自動調整**: GPXルート読み込み時や目的地ルート計算時に、ルート全体が収まるように表示を自動調整します。
*   **エラーハンドリング**: 位置情報の取得失敗時（権限拒否、利用不可、タイムアウトなど）やルート計算失敗時に適切なメッセージを表示します。
*   **レスポンシブデザイン**: コントロールパネルと地図表示パネルを分離し、携帯電話などの小さい画面でもバランス良く表示されるように最適化されています。

## 動作環境

*   現代のWebブラウザ (Chrome, Firefox, Safari, Edgeなど)
*   位置情報サービスへのアクセスを許可していること
*   インターネット接続（目的地ルートの計算に必要）

## 使用方法

### 1. GPXルートで誘導する場合

1.  `index.html` ファイルをWebサーバーに配置するか、直接ブラウザで開きます。
2.  「ファイルを選択」ボタンをクリックし、`*.gpx` 形式のルートファイルをアップロードします。
3.  GPXファイルが正常に読み込まれると、地図上に青いラインでルートが表示され、「誘導を開始」ボタンが有効になります。
4.  「**誘導を開始**」ボタンをクリックすると、現在地の追跡とルート案内が始まります。

### 2. 目的地ルートで誘導する場合

1.  `index.html` ファイルをWebサーバーに配置するか、直接ブラウザで開きます。
2.  地図上の任意の場所をクリックして目的地を設定します。目的地にマーカーが表示されます。
3.  現在地が取得できていない場合は、「**現在地を表示**」ボタンをクリックして現在地を取得します。
4.  現在地と目的地の両方が設定されると、赤いラインでルートが自動計算され、「誘導を開始」ボタンが有効になります。
5.  「**誘導を開始**」ボタンをクリックすると、現在地の追跡とルート案内が始まります。

### 共通の操作

*   **誘導の停止**: 「**誘導を停止**」ボタンをクリックすると、現在地の追跡が停止します。
*   **ルートのクリア**: 「**ルートクリア**」ボタンをクリックすると、表示されているGPXルートまたは目的地ルート、および関連するマーカーがすべて削除されます。

**注意**: GPXルートと目的地ルートは同時に設定できません。新しいルート（GPXまたは目的地）を設定すると、以前のルートは自動的にクリアされます。

## 技術スタック

*   **HTML5**: ページの構造
*   **CSS3**: スタイリング (レスポンシブデザインを含む)
*   **JavaScript**:
    *   **Geolocation API**: ブラウザからユーザーの現在地情報を取得し、継続的に追跡するために使用。
    *   **Leaflet.js**: オープンソースのインタラクティブマップライブラリ。地図の表示、GPXトラックの描画、マーカーの追加、地図操作などに使用。
    *   **Leaflet Routing Machine**: Leafletのプラグインで、[OSRM](http://project-osrm.org/)などのルーティングサービスと連携して経路計算と表示を行うために使用。
    *   **DOMParser**: GPXファイルをXMLとして解析するために使用。
    *   **FileReader**: ユーザーが選択したGPXファイルを読み込むために使用。
    *   **OpenStreetMap**: Leaflet.jsで表示される地図のタイルプロバイダー。

## ファイル構成